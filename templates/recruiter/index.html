{% extends 'base.html' %}

{% block title %}Recruiter Dashboard{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='recruiter_main.css') }}">
{% endblock %}

{% block content %}
    <h1>Recruiter Dashboard</h1>

    <div class="header">
        <div class="actions">
            <a href="/recruiter/company/create" class="btn btn-primary">Create New Company</a>
            <a href="/recruiter/post/create" class="btn btn-success">Create New Post</a>
            <button onclick="logout()" class="btn btn-danger">Logout</button>
        </div>
    </div>

    <!-- Companies Section -->
    <section id="companies">
        <h2>Company and Job Posts</h2>
        <div class="container" id="companiesContainer">
            {% for company in companies %}
                <a href="/recruiter/company/{{ company.id }}">
                    <div class="company">
                        <h3>{{ company.companyName }}</h3>
                        <p>{{ company.companyDescription }}</p>
                        <p>{{ company.companyPhone }}</p>
                        <p>{{ company.companyAddress }}</p>
                    </div>
                </a>
            {% endfor %}
        </div>
    </section>

    <!-- Job Posts Section -->
    <section id="posts">
        <h2>My Job Posts</h2>
        <div class="container" id="postsContainer">
            {% for post in posts %}
                <a href="/recruiter/post/{{ post.id }}">
                    <div class="post">
                        <h3>{{ post.title }}</h3>
                        <p>{{ post.description }}</p>
                    </div>
                </a>
            {% endfor %}
        </div>
    </section>

    <script>
        function logout() {
            fetch("/api/recruiter/logout", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRF-TOKEN": getCookie("csrf_access_token")
                },
                credentials: "include"
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert('Logged out successfully!');
                    window.location.href = '/login';
                } else {
                    alert('Logout failed');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Logout failed');
            });
        }
    </script>

{% endblock %}